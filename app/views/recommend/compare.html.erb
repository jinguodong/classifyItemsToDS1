<div class='recommend' id='recommend'>
  <h2>Recommended item to <%= @local_params['fulfil_name'] %></h2>
  <div class="itemsContainer floatLeft">
      <div class="item no_href">
        <div class="itemInner">
          <div class="productImage">
            <img src=<%= @other_item['img_url'] %> />
          </div>
          <div class="name"><%= @other_item['name'] %></div>
          <div class="price">
            <!-- <span class="listPrice">$41.99</span> -->
            <span class="ourPrice">Price: $<%= @other_item['cogs'] %></span>
          </div>
          <div class="weight">
            <span class="weightAll">Weight: <%= @other_item['weight'] %></span>
          </div>
        </div>
      </div>
    <div class="splitLine"></div>
  </div>
  <div class="itemsContainer floatRight">
    <% v = @ds_item %>
    <div class="item no_href">
      <div class="itemInner">
        <div class="productImage">
          <img src=<%= v['img_url'] %> />
        </div>
        <div class="name"><%= v['name'] %></div>
        <div class="price">
          <!-- <span class="listPrice">$41.99</span> -->
          <span class="ourPrice">Price: $<%= v['cogs'] %></span>
        </div>
        <div class="weight">
          <span class="weightAll">Weight: <%= v['weight'] %></span>
        </div>
        <div class="reason">
          
        </div>
      </div>
    </div>
    <% #break %>
    
    <div class="splitLine"></div>
  </div>

  <div class="splitLine"></div>

  
  <div class="item_graphs">
    <div class="item_graph">
      <h4 style="color:orange">Customer Demand Profile</h4>
      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the shipment ratio weekly of the ASIN.</p></div>
      <div id='shipment_ratio_graph_per_week' class="display_show info_graph">
      </div>
    </div>

    <div class="item_graph">
      <h4 style="color:orange">Vendor Profile</h4>
      
      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the weekly volumes.</p></div>
      <div id='low_weekly_volumes' class="display_show info_graph">
      </div>

      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you high peakiness reason.</p></div>
      <div id='other_high_peakiness' class="display_show info_graph">
      </div>

    </div>

    <div class="item_graph">
      <h4 style="color:orange">ASIN Profile</h4>
      
      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the customer returns weekly.</p></div>
      <div id='high_customer_returns' class="display_show info_graph">
      </div>
      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the vendor returns weekly.</p></div>
      <div id='high_vendor_returns' class="display_show info_graph">
      </div>
      
    </div>

    <div class="item_graph">
      <h4 style="color:orange">COST Profile</h4>
      
      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the List Price on www.amazon.com from 2014-3-1 to 2014-6-30. If there is no point on some day, it means that on that day there is no shipment of the item.</p></div>
      <div id='list_price' class="display_show info_graph">
      </div>

      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the Cost of Goods from 2014-3-1 to 2014-6-30. If there is no point on some day, it means that on that day there is no shipment of the item.</p></div>
      <div id='cost_of_goods' class="display_show info_graph">
      </div>

      <div class="note"><p class="note_content"><b>Note:</b>This graph shows you the ship charge from 2014-3-1 to 2014-6-30. If there is no point on some day, it means that on that day there is no shipment of the item.</p></div>
      <div id='ship_charge' class="display_show info_graph">
      </div>
      
    </div>

  </div>

  <div class="splitLine"></div>

</div>

<script>
  function draw_graph(_id, _type, _title, _subtitle, _series_name, _data) {
    $("#"+_id).highcharts({
        chart: {
            type: _type
        },
        title: {
            text: _title
        },
        subtitle: {
            text: _subtitle
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { // don't display the dummy year
                month: '%e of %b',
                year: '%Y'
            }
        },
        yAxis: {
            title: {
                text: 'List Pirce ($)'
            }
        },
        tooltip: {
            formatter: function() {
                    return 'List Price' +': '+ this.y +' $';
            }
        },
        
        series: [{
            name: _series_name,
            // Define the data points. All series have a dummy year
            // of 1970/71 in order to be compared on the same x axis. Note
            // that in JavaScript, months start at 0 for January, 1 for February etc.
            data: _data
        }]
    });
  }

  function draw_weekly_graph(_id, _type, _title, _subtitle, _ytitle, _vname, _data, _data1, _compare_data_down=1.13, _compare_data_up=1.87){
      _compare_arr_down = []
      _compare_arr_up = []
      for(var a in _data){
        _compare_arr_down.push(_compare_data_down)
        _compare_arr_up.push(_compare_data_up)
      }
      $("#"+_id).highcharts({
          chart: {
              type: _type
          },
          title: {
              text: _title
          },
          subtitle: {
              text: _subtitle
          },
          xAxis: {
              categories: [
                  9,
                  10,
                  11,
                  12,
                  13,
                  14,
                  15,
                  16,
                  17,
                  18,
                  19,
                  20,
                  21,
                  22,
                  23,
                  24,
                  25,
                  26,
                  27,
              ]
          },
          yAxis: {
              title: {
                  text: _ytitle
              }
          },
          tooltip: {
              headerFormat: '<span style="color:{series.color}">Week: </span><span>{point.key}</span><table>',
              pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                  '<td style="padding:0"><b>{point.y} </b></td></tr>',
              footerFormat: '</table>',
              shared: true,
              useHTML: true
          },
          plotOptions: {
              column: {
                  pointPadding: 0.2,
                  borderWidth: 0
              }
          },
          series: [{
              name: 'Recommended Item',
              data: _data
          },{
            name: 'Item in DS',
            data: _data1
          }, {name: 'Down threshold', data: _compare_arr_down},
          {name: 'Up threshold', data: _compare_arr_up}]
      });
  }

  function draw_pie(_id, _type, _title, _data, _data1){
    $("#"+_id).highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
        },
        title: {
            text: _title
        },
        tooltip: {
          pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    color: '#000000',
                    connectorColor: '#000000',
                    formatter: function() {
                        return '<b>'+ this.point.name +'</b>: '+ this.percentage +' %';
                    }
                }
            }
        },
        series: [{
            type: _type,
            name: 'Recommended Item',
            data: _data,
            center: [220, 130],
            size: 200,
        },
        {
            type: _type,
            name: "Item in DS",
            data: _data1,
            center: [640, 130],
            size: 200,
        }]
    });
  }

  function draw_time_point(_id, _type, _title, _subtitle, _ytitle, _data, _data1, _compare_data_down=1.13, _compare_data_up=1.87){
    _compare_arr_down = []
    _compare_arr_up = []
    if (_data[0][0] > _data1[0][0]){
      _compare_arr_down.push([_data1[0][0], _compare_data_down]);
      _compare_arr_up.push([_data1[0][0], _compare_data_up]);
    }
    for(var a in _data){
      _compare_arr_down.push([_data[a][0], _compare_data_down])
      _compare_arr_up.push([_data[a][0], _compare_data_up])
    }
    if (_data[_data.length-1][0] < _data1[_data1.length-1][0]){
      _compare_arr_down.push([_data1[_data1.length-1][0], _compare_data_down]);
      _compare_arr_up.push([_data1[_data1.length-1][0], _compare_data_up]);
    }
    $('#'+_id).highcharts({
        chart: {
            type: _type
        },
        title: {
            text: _title
        },
        subtitle: {
            text: _subtitle
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { // don't display the dummy year
                month: '%e of %b',
                year: '%Y'
            }
        },
        yAxis: {
            title: {
                text: _ytitle
            }
        },
        tooltip: {
            formatter: function() {
                    return _ytitle +': '+ this.y +' $';
            }
        },
        
        series: [{
            name: "Recommended Item",
            // Define the data points. All series have a dummy year
            // of 1970/71 in order to be compared on the same x axis. Note
            // that in JavaScript, months start at 0 for January, 1 for February etc.
            data: _data
        }, {
            name: "Item in DS",
            data: _data1
        }, {
            name: 'Down threshold',
            // Define the data points. All series have a dummy year
            // of 1970/71 in order to be compared on the same x axis. Note
            // that in JavaScript, months start at 0 for January, 1 for February etc.
            data: _compare_arr_down
        }, {
            name: 'Up threshold',
            // Define the data points. All series have a dummy year
            // of 1970/71 in order to be compared on the same x axis. Note
            // that in JavaScript, months start at 0 for January, 1 for February etc.
            data: _compare_arr_up
        }]
    });
  }

  function get_subtitle(other, ds){
    _subtitle = 'Recommended Item:[AVG: '+other[2]+' Variability: '+other[3]+' Coefficient of Variation: '+other[4]+'] <br /> Item in <%= @local_params['fulfil_name'] %>: [AVG: '+ds[2]+' Variability: '+ds[3]+' Coefficient of Variation: '+ds[4]+']';
    return _subtitle
  }

$(document).ready(function(){
  subtitle = get_subtitle(<%= "[#{@other_shipment_ratio_graph_per_week_math.join(",")}]" %>, <%= "[#{@ds_shipment_ratio_graph_per_week_math.join(",")}]" %>);
  draw_weekly_graph('shipment_ratio_graph_per_week', 'spline', 'Shipment Ratio', subtitle, "Shipment Ratio", "Ratio", [<% (9..27).each do |i| %><%= @other_shipment_ratio_graph_per_week[i] %>,<% end %>], [<% (9..27).each do |i| %><%= @ds_shipment_ratio_graph_per_week[i] %>,<% end %>], <%= @other_shipment_ratio_graph_per_week_math[2].to_f - @other_shipment_ratio_graph_per_week_math[2].to_f*0.1 %>, <%= @other_shipment_ratio_graph_per_week_math[2].to_f + @other_shipment_ratio_graph_per_week_math[2].to_f*0.1 %>);

  subtitle = get_subtitle(<%= "[#{@other_low_weekly_volumes_math.join(",")}]" %>, <%= "[#{@ds_low_weekly_volumes_math.join(",")}]" %>);
  draw_weekly_graph('low_weekly_volumes', 'spline', 'Weekly Volumes', subtitle, "Weekly Volumes", "Weekly Volumes", [<% (9..27).each do |i| %><%= @other_low_weekly_volumes[i] %>,<% end %>], [<% (9..27).each do |i| %><%= @ds_low_weekly_volumes[i] %>,<% end %>], <%= @other_low_weekly_volumes_math[2].to_f - @other_low_weekly_volumes_math[2].to_f*0.1 %>, <%= @other_low_weekly_volumes_math[2].to_f + @other_low_weekly_volumes_math[2].to_f*0.1 %>);

  draw_pie('other_high_peakiness', 'pie', 'High Peakiness', [['others', <%= "#{@other_high_peakiness[1]}" %>],{name:'High Peakiness', y:<%= "#{@other_high_peakiness[0]}" %>, sliced:true, selected:true}], [{name:'others', y:<%= "#{@ds_high_peakiness[1]}" %>, color:Highcharts.getOptions().colors[3]},{name:'High Peakiness', y:<%= "#{@ds_high_peakiness[0]}" %>, color:Highcharts.getOptions().colors[4], sliced:true, selected:true}]);
  
  subtitle = get_subtitle(<%= "[#{@other_high_customer_returns_math.join(",")}]" %>, <%= "[#{@ds_high_customer_returns_math.join(",")}]" %>);
  draw_weekly_graph('high_customer_returns', 'spline', 'Weekly Customer Returns', subtitle, "Weekly Customer Returns", "Weekly Customer Returns", [<% (9..27).each do |i| %><%= @other_high_customer_returns[i] %>,<% end %>], [<% (9..27).each do |i| %><%= @ds_high_customer_returns[i] %>,<% end %>], <%= @other_high_customer_returns_math[2].to_f - @other_high_customer_returns_math[2].to_f*0.1 %>, <%= @other_high_customer_returns_math[2].to_f + @other_high_customer_returns_math[2].to_f*0.1 %>);
  
  subtitle = get_subtitle(<%= "[#{@other_high_vendor_returns_math.join(",")}]" %>, <%= "[#{@ds_high_vendor_returns_math.join(",")}]" %>);
  draw_weekly_graph('high_vendor_returns', 'spline', 'Weekly Vendor Returns', subtitle, "Weekly Vendor Returns", "Weekly Vendor Returns", [<% (9..27).each do |i| %><%= @other_high_vendor_returns[i] %>,<% end %>], [<% (9..27).each do |i| %><%= @ds_high_vendor_returns[i] %>,<% end %>], <%= @other_high_vendor_returns_math[2].to_f - @other_high_vendor_returns_math[2].to_f*0.1 %>, <%= @other_high_vendor_returns_math[2].to_f + @other_high_vendor_returns_math[2].to_f*0.1 %>);
  
  subtitle = get_subtitle(<%= "[#{@other_date_list_price_math.join(",")}]" %>, <%= "[#{@ds_date_list_price_math.join(",")}]" %>);
  draw_time_point('list_price', 'spline', 'List Price', subtitle, "List Price", [
    <% @other_date_list_price.each do |item| %>
      [Date.UTC(<%= item[0] %>, <%= item[1] %>, <%= item[2] %>), <%= item[3] %>],
    <% end %>], [
    <% @ds_date_list_price.each do |item| %>
      [Date.UTC(<%= item[0] %>, <%= item[1] %>, <%= item[2] %>), <%= item[3] %>],
    <% end %>] , <%= @other_date_list_price_math[2].to_f - @other_date_list_price_math[2].to_f*0.1 %>, <%= @other_date_list_price_math[2].to_f + @other_date_list_price_math[2].to_f*0.1 %>);
  
  subtitle = get_subtitle(<%= "[#{@other_date_cogs_math.join(",")}]" %>, <%= "[#{@ds_date_cogs_math.join(",")}]" %>);
  draw_time_point('cost_of_goods', 'spline', 'Cost of Goods', subtitle, "Cost of Goods", [
    <% @other_date_cogs.each do |item| %>
      [Date.UTC(<%= item[0] %>, <%= item[1] %>, <%= item[2] %>), <%= item[3] %>],
    <% end %>], [
    <% @ds_date_cogs.each do |item| %>
      [Date.UTC(<%= item[0] %>, <%= item[1] %>, <%= item[2] %>), <%= item[3] %>],
    <% end %>], <%= @other_date_cogs_math[2].to_f - @other_date_cogs_math[2].to_f*0.1 %>, <%= @other_date_cogs_math[2].to_f + @other_date_cogs_math[2].to_f*0.1 %>);

  subtitle = get_subtitle(<%= "[#{@other_date_ship_charge_math.join(",")}]" %>, <%= "[#{@ds_date_ship_charge_math.join(",")}]" %>);
  draw_time_point('ship_charge', 'spline', 'Ship Charge', subtitle, "Ship Charge", [
    <% @other_date_ship_charge.each do |item| %>
      [Date.UTC(<%= item[0] %>, <%= item[1] %>, <%= item[2] %>), <%= item[3] %>],
    <% end %>], [
    <% @ds_date_ship_charge.each do |item| %>
      [Date.UTC(<%= item[0] %>, <%= item[1] %>, <%= item[2] %>), <%= item[3] %>],
    <% end %>], <%= @other_date_ship_charge_math[2].to_f - @other_date_ship_charge_math[2].to_f*0.1 %>, <%= @other_date_ship_charge_math[2].to_f + @other_date_ship_charge_math[2].to_f*0.1 %> );
  
});

</script>